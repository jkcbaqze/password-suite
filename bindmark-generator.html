<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bindmark Encoder/Decoder</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav>
    <a href="dashboard.html">Dashboard</a>
    <a href="omni-password.html">Password Generator</a>
    <a href="username-generator.html">Username Generator</a>
  </nav>

  <div class="container">
    <h1>ðŸ§¬ Bindmark Encoder/Decoder</h1>

    <label for="hintInput">Enter Hint (4â€“24 characters):</label>
    <input type="text" id="hintInput" maxlength="24">
    <button onclick="generateBindmark()">Generate</button>

    <div class="output" id="result" style="display: none;"></div>

    <hr>

    <label for="usernameInput">Decode Username:</label>
    <input type="text" id="usernameInput">
    <label for="passwordInput">Decode Password:</label>
    <input type="text" id="passwordInput">
    <button onclick="decodeBindmark()">Decode</button>

    <div class="output" id="decoded" style="display: none;"></div>
  </div>

  <script>
    const CHAR_POOL = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*';
    const TRANSFORM_OFFSET = 7;
    const HINT_LENGTH_BASE = 66;
    const TARGET_LENGTH = 18;

    function getRandomChar() {
      return CHAR_POOL[Math.floor(Math.random() * CHAR_POOL.length)];
    }

    function transformHint(hint) {
      return hint.split('').map(char => {
        let code = char.charCodeAt(0) + TRANSFORM_OFFSET;
        if (code > 126) code = 33 + (code % 126);
        return String.fromCharCode(code);
      });
    }

    function reverseTransformHint(transformed) {
      return transformed.map(char => {
        let code = char.charCodeAt(0) - TRANSFORM_OFFSET;
        if (code < 33) code = 126 - (33 - code);
        return String.fromCharCode(code);
      }).join('');
    }

    function generateInjectionIndexes(count, reserved = []) {
      const spacing = Math.floor(TARGET_LENGTH / count);
      const indexes = [];
      let attempt = 0;

      for (let i = 0; i < count; i++) {
        let idx = i * spacing;
        while (reserved.includes(idx) && attempt < TARGET_LENGTH) {
          idx = (idx + 1) % TARGET_LENGTH;
          attempt++;
        }
        indexes.push(idx);
      }

      return indexes;
    }

    function injectChars(baseArray, chars, indexes) {
      indexes.forEach((idx, i) => {
        baseArray[idx] = chars[i];
      });
    }

    function generateBindmark() {
      const hint = document.getElementById('hintInput').value.trim();
      if (hint.length < 4 || hint.length > 24) {
        alert('Hint must be 4 to 24 characters.');
        return;
      }

      const transformed = transformHint(hint);
      const half = Math.ceil(transformed.length / 2);
      const userPart = transformed.slice(0, half);
      const passPart = transformed.slice(half);

      const userArr = Array.from({ length: TARGET_LENGTH }, getRandomChar);
      const passArr = Array.from({ length: TARGET_LENGTH }, getRandomChar);

      const userIndexes = generateInjectionIndexes(userPart.length, [5]);
      const passIndexes = generateInjectionIndexes(passPart.length, [7]);
      injectChars(userArr, userPart, userIndexes);
      injectChars(passArr, passPart, passIndexes);

      const total = hint.length + HINT_LENGTH_BASE;
      const part1 = Math.floor(Math.random() * (total - 66)) + 33;
      const part2 = total - part1;
      userArr[5] = String.fromCharCode(part1);
      passArr[7] = String.fromCharCode(part2);

      const username = userArr.join('');
      const password = passArr.join('');

      document.getElementById('result').style.display = 'block';
      document.getElementById('result').textContent = `Username: ${username}\nPassword: ${password}`;
    }

    function decodeBindmark() {
      const username = document.getElementById('usernameInput').value.trim();
      const password = document.getElementById('passwordInput').value.trim();
      if (username.length !== TARGET_LENGTH || password.length !== TARGET_LENGTH) {
        alert('Both fields must be exactly 18 characters.');
        return;
      }

      const part1 = username.charCodeAt(5);
      const part2 = password.charCodeAt(7);
      const hintLength = part1 + part2 - HINT_LENGTH_BASE;

      const totalChars = hintLength;
      const half = Math.ceil(totalChars / 2);
      const userIndexes = generateInjectionIndexes(half, [5]);
      const passIndexes = generateInjectionIndexes(totalChars - half, [7]);

      let extracted = [];
      userIndexes.forEach(i => extracted.push(username[i]));
      passIndexes.forEach(i => extracted.push(password[i]));

      const hint = reverseTransformHint(extracted).slice(0, totalChars);
      document.getElementById('decoded').style.display = 'block';
      document.getElementById('decoded').textContent = `Reconstructed Hint: ${hint}`;
    }
  </script>
</body>
</html>